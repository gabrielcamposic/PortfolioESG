<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modelo Portfolio ESG: Investimento Consciente e Rentável</title>
    <link rel="stylesheet" href="html/css/navbar_styles.css"> <!-- Styles for the top navigation bar -->
    <link rel="stylesheet" href="html/css/styles.css">       <!-- Common styles for content blocks, tables, etc. -->
</head>
<body>
    <div id="navbar-placeholder"></div> <!-- Placeholder for the common navigation bar -->

    <div class="main-content">
        <div class="language-switcher" style="text-align: right; margin-bottom: 15px;">
            <button id="lang-pt-BR">Português</button>
            <button id="lang-en">English</button>
            <button id="lang-es">Español</button>
        </div>

        <h1>Modelo Portfolio ESG</h1>
        <p class="page-subtitle">Investimento Consciente e Rentável em Python</p>

        <div class="stage-block" id="overview">
            <h2>Visão Geral: Alinhando Lucro e Propósito ESG</h2>
            <!-- Content will be loaded here by JavaScript -->
        </div>

        <div class="stage-block" id="how-it-works">
            <h2>Como Funciona: Inteligência Quantitativa Aplicada</h2>
            <!-- Content will be loaded here by JavaScript -->
        </div>

        <div class="stage-block" id="features">
            <h2>Funcionalidades Principais</h2>
            <!-- Content will be loaded here by JavaScript -->
        </div>

        <div class="stage-block" id="technology">
            <h2>Tecnologia e Desenvolvimento</h2>
            <!-- Content will be loaded here by JavaScript -->
        </div>

        <div class="stage-block" id="status-future">
            <h2>Status e Futuro do Projeto (Open Source)</h2>
            <!-- Content will be loaded here by JavaScript -->
        </div>

        <div class="stage-block" id="contact">
            <h2>Acesse o Código e Conecte-se</h2>
            <!-- Content will be loaded here by JavaScript -->
        </div>
    </div> <!-- End of main-content -->

    <script src="html/js/common_utils.js"></script> <!-- Common utility functions -->
    <script src="html/js/common_nav.js"></script>   <!-- Script to load and manage the navbar -->
    <script>
        const translations = {
            "pt-BR": {
                pageTitle: "Modelo Portfolio ESG",
                pageSubtitle: "Investimento Consciente e Rentável em Python",
                overviewTitle: "Visão Geral: Alinhando Lucro e Propósito ESG",
                howItWorksTitle: "Como Funciona: Inteligência Quantitativa Aplicada",
                featuresTitle: "Funcionalidades Principais",
                technologyTitle: "Tecnologia e Desenvolvimento",
                statusFutureTitle: "Status e Futuro do Projeto (Open Source)",
                contactTitle: "Acesse o Código e Conecte-se",
                navOverview: "Visão Geral",
                navHowItWorks: "Como Funciona",
                navFeatures: "Funcionalidades",
                navTechnology: "Tecnologia",
                navStatusFuture: "Status e Futuro",
                navContact: "Contato"
            },
            en: {
                pageTitle: "ESG Portfolio Model",
                pageSubtitle: "Conscious and Profitable Investment in Python",
                overviewTitle: "Overview: Aligning Profit and ESG Purpose",
                howItWorksTitle: "How It Works: Applied Quantitative Intelligence",
                featuresTitle: "Main Features",
                technologyTitle: "Technology and Development",
                statusFutureTitle: "Status and Future (Open Source)",
                contactTitle: "Access Code and Connect",
                navOverview: "Overview",
                navHowItWorks: "How It Works",
                navFeatures: "Features",
                navTechnology: "Technology",
                navStatusFuture: "Status & Future",
                navContact: "Contact"
            },
            es: {
                pageTitle: "Modelo de Portafolio ESG",
                pageSubtitle: "Inversión Consciente y Rentable en Python",
                overviewTitle: "Visión General: Alineando Beneficio y Propósito ESG",
                howItWorksTitle: "Cómo Funciona: Inteligencia Cuantitativa Aplicada",
                featuresTitle: "Funcionalidades Principales",
                technologyTitle: "Tecnología y Desarrollo",
                statusFutureTitle: "Estado y Futuro (Código Abierto)",
                contactTitle: "Acceder al Código y Conectar",
                navOverview: "Visión General",
                navHowItWorks: "Cómo Funciona",
                navFeatures: "Funcionalidades",
                navTechnology: "Tecnología",
                navStatusFuture: "Estado y Futuro",
                navContact: "Contacto"
            }
        };

        let currentLanguage = localStorage.getItem('preferredLanguage') || 'pt-BR'; // Default to Portuguese

        function setLanguage(lang) {
            currentLanguage = lang;
            localStorage.setItem('preferredLanguage', lang);
            updatePageText();
            if (typeof window.updateIndexNavbarLinksText === 'function') {
                 window.updateIndexNavbarLinksText(translations[currentLanguage]);
            }
        }

        function updatePageText() {
            const langTrans = translations[currentLanguage];
            if (!langTrans) return;

            document.querySelector('.main-content > h1').textContent = langTrans.pageTitle;
            document.querySelector('.page-subtitle').textContent = langTrans.pageSubtitle;
            document.querySelector('#overview h2').textContent = langTrans.overviewTitle;
            document.querySelector('#how-it-works h2').textContent = langTrans.howItWorksTitle;
            document.querySelector('#features h2').textContent = langTrans.featuresTitle;
            document.querySelector('#technology h2').textContent = langTrans.technologyTitle;
            document.querySelector('#status-future h2').textContent = langTrans.statusFutureTitle;
            document.querySelector('#contact h2').textContent = langTrans.contactTitle;

            loadTextContent();
        }

        async function loadTextContent() {
            const sections = [
                { id: 'overview', file: 'text_content/overview.txt' },
                { id: 'how-it-works', file: 'text_content/how_it_works.txt' },
                { id: 'features', file: 'text_content/features.txt' },
                { id: 'technology', file: 'text_content/technology.txt' },
                { id: 'status-future', file: 'text_content/status_future.txt' },
                { id: 'contact', file: 'text_content/contact.txt' }
            ];

            const baseContentPath = `text_content/${currentLanguage}/`;

            for (const section of sections) {
                const sectionElement = document.getElementById(section.id);
                if (sectionElement) {
                    const h2Element = sectionElement.querySelector('h2');
                    if (!h2Element) {
                        console.error(`No h2 found in section ${section.id}`);
                        sectionElement.innerHTML = `<p style="color:red;">Error: Section structure incorrect (missing h2).</p>`;
                        continue;
                    }

                    // Remove existing content after h2 (if any, though it should be empty now)
                    while (h2Element.nextSibling) {
                        sectionElement.removeChild(h2Element.nextSibling);
                    }

                    try {
                        const response = await fetch(baseContentPath + section.file.split('/').pop() + '?t=' + new Date().getTime()); // Cache buster
                        if (response.ok) {
                            const htmlContent = await response.text();
                            // Create a temporary div to parse the HTML string
                            const tempDiv = document.createElement('div');
                            tempDiv.innerHTML = htmlContent;
                            // Append all children of tempDiv after h2
                            while (tempDiv.firstChild) {
                                sectionElement.appendChild(tempDiv.firstChild);
                            }
                        } else {
                            const errorP = document.createElement('p');
                            errorP.style.color = 'red';
                            errorP.textContent = `Error loading content for this section. (${response.status})`;
                            sectionElement.appendChild(errorP);
                            console.error(`Failed to load ${section.file}: ${response.status}`);
                        }
                    } catch (error) {
                        const errorP = document.createElement('p');
                        errorP.style.color = 'red';
                        errorP.textContent = `Error loading content for this section.`;
                        sectionElement.appendChild(errorP);
                        console.error(`Error fetching ${section.file}:`, error);
                    }
                }
            }
        }

        // Function to be called by common_nav.js to update navbar link texts
        window.updateIndexNavbarLinksText = function(langTrans) {
            if (!langTrans) langTrans = translations[currentLanguage]; // Fallback if not passed
            const navLinksUl = document.querySelector('#top-navbar .nav-links');
            if (navLinksUl && langTrans) {
                const linksMap = {
                    '#overview': langTrans.navOverview, '#how-it-works': langTrans.navHowItWorks,
                    '#features': langTrans.navFeatures, '#technology': langTrans.navTechnology,
                    '#status-future': langTrans.navStatusFuture, '#contact': langTrans.navContact
                };
                navLinksUl.querySelectorAll('a').forEach(a => {
                    const href = a.getAttribute('href');
                    if (linksMap[href]) a.textContent = linksMap[href];
                });
            }
        };

        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('lang-pt-BR').addEventListener('click', () => setLanguage('pt-BR'));
            document.getElementById('lang-en').addEventListener('click', () => setLanguage('en'));
            document.getElementById('lang-es').addEventListener('click', () => setLanguage('es'));
            setLanguage(currentLanguage); // Initialize with current or default language
        });
    </script>
</body>
</html>
